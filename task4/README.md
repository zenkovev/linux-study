# Комментарии к заданию

## Задание

Необходимо создать модуль ядра, который будет регистрировать запись в `procfs` `/proc/mmaneg`.
Используя эту запись, модуль может принимать следующие команды:
- `listvma`: отобразить все VMA текущего процесса
- `findpage addr`: найти `va->pa` адресную трансляцию в `mm` контексте текущего процесса и
отобразить её
- `writeval addr val`: изменить содержимое `unsigned long` для текущего процесса на `val`

Весь вывод должен быть доступен в `dmesg`.

## Демонстрация

Находится в файле `demonstration.mp4`.

## Про файлы в procfs

Очень полезные статьи:
- [Работа с procfs](https://habr.com/ru/companies/ruvds/articles/684382/)
- [Весь цикл статей](https://habr.com/ru/companies/ruvds/articles/681880/)

Было также реализовано чтение из файла:
```shell
cat /proc/mmaneg
# выполняет команду listvma
# вместо dmesg результат выводится в консоль
```

## Про VMA

VMA: Области виртуальной памяти (`vm_area_struct`):
- машинный код - сегмент кода
- инициализированные переменные - сегмент данных
- неинициализированные глобальные переменные - сегмент bss
- пользовательский стек процесса
- все отображенные файлы
- совместно используемая память

Структуры и функции для работы:
- `linux-6.7.4/include/linux/mm_types.h`

## Про адреса

Преобразование виртуального адреса в физический:
- `linux-6.7.4/arch/x86/include/asm/io.h`

Управление памятью в юзерспейсе, сигнатура функций может отличаться:
- [Memory Management APIs](https://www.kernel.org/doc/html/v4.20/core-api/mm-api.html)

Замечание: функция `put_user` под капотом знает, какой процесс вызвал системный вызов,
соответственно, может работать с виртуальным адресным пространством этого процесса,
поэтому, для проверки `writeval` можно использовать тест из `check.c`.